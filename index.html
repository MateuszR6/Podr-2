<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Planer Podróży</title>
  <!-- Bootstrap i Leaflet CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { padding: 10px; }
    #map { height: 400px; }
    .sidebar { max-height: 400px; overflow-y: auto; }
    .point-img { max-width: 100%; height: auto; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container-fluid">
    <h1 class="text-center">Planer Podróży</h1>
    <div class="row">
      <div class="col-md-8">
         <div id="map"></div>
         <button id="addRouteBtn" class="btn btn-primary mt-2 btn-block">Dodaj trasę</button>
      </div>
      <div class="col-md-4">
         <h4>Punkty</h4>
         <select id="filterType" class="form-control mb-2">
           <option value="">Wszystkie</option>
           <option value="Jedzenie">Jedzenie</option>
           <option value="Nocleg">Nocleg</option>
           <option value="Atrakcja">Atrakcja</option>
         </select>
         <ul id="pointsList" class="list-group sidebar"></ul>
         <hr>
         <h4>Trasy</h4>
         <ul id="routesList" class="list-group sidebar"></ul>
         <hr>
         <h4>Budżet</h4>
         <ul id="budgetList" class="list-group sidebar"></ul>
         <hr>
         <h4>Koszty dodatkowe</h4>
         <input type="text" id="extraDesc" placeholder="Opis" class="form-control mb-1">
         <input type="number" id="extraCost" placeholder="Koszt" class="form-control mb-1">
         <button id="addExtraBtn" class="btn btn-secondary btn-block">Dodaj</button>
         <ul id="extrasList" class="list-group sidebar mt-2"></ul>
      </div>
    </div>
  </div>
  <!-- Skrypty: jQuery, Popper, Bootstrap, Leaflet -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([52.0, 19.0], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    let markers = {}, routes = {}, extras = [];
    const typeColors = {"Jedzenie":"red","Nocleg":"blue","Atrakcja":"green"};

    function refreshPointsList(){
      const list = document.getElementById('pointsList');
      list.innerHTML = "";
      const filter = document.getElementById('filterType').value;

      Object.values(markers).forEach(pt => {
        if (filter && pt.type !== filter) return;

        const li = document.createElement('li');
        li.className = "list-group-item";
        li.innerHTML = `
          <b>${pt.name}</b><br>
          Typ: ${pt.type}<br>
          Opis: ${pt.desc}<br>
          Adres: ${pt.address}<br>
          Koszt: ${pt.cost} zł<br>
          ${pt.img ? `<img src="${pt.img}" alt="Obrazek" class="point-img">` : ""}
        `;

        const edit = document.createElement('button');
        edit.textContent = "Edytuj";
        edit.className = "btn btn-sm btn-info ml-2";
        edit.onclick = () => openMarkerModal(pt);

        const del = document.createElement('button');
        del.textContent = "Usuń";
        del.className = "btn btn-sm btn-danger ml-2";
        del.onclick = () => removeMarker(pt.id);

        li.appendChild(edit);
        li.appendChild(del);
        list.appendChild(li);
      });
    }

    function addMarkerToMap(data, doSave = true) {
      const m = L.circleMarker([data.lat, data.lng], {
        color: typeColors[data.type] || "black"
      }).addTo(map).bindPopup(`<b>${data.name}</b><br>${data.desc}`);
      data._leaflet_id = m._leaflet_id;
      markers[data.id] = data;
      if (doSave) {
        savePoints();
        refreshPointsList();
      }
    }

    // Pozostała część kodu pozostaje taka sama, w tym funkcje dotyczące tras, budżetu, kosztów dodatkowych, modali itd.

    function savePoints() {
      localStorage.setItem('points', JSON.stringify(Object.values(markers)));
    }

    document.getElementById('filterType').addEventListener('change', refreshPointsList);
  </script>
</body>
</html>
