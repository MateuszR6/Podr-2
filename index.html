<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Podr√≥≈º Gosi i Mateusza</title>

    <!-- Linki do zewnƒôtrznych arkuszy styl√≥w -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        /* Stylowanie og√≥lne */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        header {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 20px;
        }

        h1 {
            margin: 0;
            font-size: 2em;
        }

        .container {
            padding: 20px;
        }

        .map-container {
            width: 100%;
            height: 400px;
            margin-top: 20px;
        }

        /* Stylowanie mapy */
        #map {
            width: 100%;
            height: 100%;
        }

        /* Stylowanie przycisk√≥w */
        .btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <header>
        <h1>Podr√≥≈º Gosi i Mateusza</h1>
    </header>

    <div class="container">
        <!-- Sekcja Mapy -->
        <section id="map-section">
            <h2>Mapa</h2>
            <div id="map" class="map-container"></div>
            <button class="btn" id="add-point-btn">Dodaj Punkt</button>
        </section>
    </div>

    <!-- Skrypty JavaScript -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Inicjalizacja mapy
        var map = L.map('map').setView([51.505, -0.09], 2); // PoczƒÖtkowy widok na mapƒô (szeroko≈õƒá, d≈Çugo≈õƒá geograficzna)

        // ≈Åadowanie mapy z OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Dodawanie punkt√≥w na mapie (przyk≈Çadowy punkt)
        var marker = L.circleMarker([51.505, -0.09], {
            color: 'red',
            radius: 10
        }).addTo(map).bindPopup('Przyk≈Çadowy punkt');

        // Funkcja dodajƒÖca punkt na mapie
        document.getElementById('add-point-btn').addEventListener('click', function() {
            var latLng = map.getCenter(); // Pobierz aktualne wsp√≥≈Çrzƒôdne mapy (na przyk≈Çadzie)
            var marker = L.circleMarker(latLng, {
                color: 'blue',
                radius: 10
            }).addTo(map).bindPopup('Nowy punkt');
        });
    </script>
</body>
</html>
<!-- MODAL DODAWANIA PUNKTU -->
<div id="pointModal" style="display:none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
    background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.3); z-index: 1000;">
    <h3>Dodaj punkt</h3>
    <form id="pointForm">
        <input type="text" id="pointName" placeholder="Nazwa" required><br><br>
        <select id="pointType" required>
            <option value="">Typ</option>
            <option value="Atrakcja">Atrakcja</option>
            <option value="Jedzenie">Jedzenie</option>
            <option value="Nocleg">Nocleg</option>
            <option value="Inne">Inne</option>
        </select><br><br>
        <textarea id="pointDesc" placeholder="Opis"></textarea><br><br>
        <input type="text" id="pointAddress" placeholder="Adres"><br><br>
        <input type="number" id="pointCost" placeholder="Koszt (z≈Ç/‚Ç¨)"><br><br>
        <input type="url" id="pointImg" placeholder="URL obrazka"><br><br>
        <button type="submit" class="btn">Zapisz</button>
        <button type="button" class="btn" onclick="closeModal()">Anuluj</button>
    </form>
</div>

<script>
    // PUNKTY: dane i kolory wg typu
    let points = [];
    const pointColors = {
        "Atrakcja": "orange",
        "Jedzenie": "green",
        "Nocleg": "blue",
        "Inne": "purple"
    };

    // Obs≈Çuga klikniƒôcia na mapie ‚Äì otw√≥rz modal
    map.on('click', function(e) {
        selectedLatLng = e.latlng;
        openModal();
    });

    // Otw√≥rz modal
    function openModal() {
        document.getElementById('pointModal').style.display = 'block';
    }

    // Zamknij modal
    function closeModal() {
        document.getElementById('pointForm').reset();
        document.getElementById('pointModal').style.display = 'none';
    }

    // Dodanie punktu z formularza
    document.getElementById('pointForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const point = {
            id: Date.now(),
            name: document.getElementById('pointName').value,
            type: document.getElementById('pointType').value,
            desc: document.getElementById('pointDesc').value,
            address: document.getElementById('pointAddress').value,
            cost: parseFloat(document.getElementById('pointCost').value) || 0,
            img: document.getElementById('pointImg').value,
            latlng: selectedLatLng
        };
        points.push(point);
        addMarkerToMap(point);
        closeModal();
    });

    // Dodaj znacznik na mapƒô
    function addMarkerToMap(point) {
        const color = pointColors[point.type] || "gray";
        const marker = L.circleMarker(point.latlng, {
            color: color,
            radius: 10
        }).addTo(map).bindPopup(`
            <strong>${point.name}</strong><br>
            ${point.type}<br>
            ${point.desc}<br>
            ${point.address}<br>
            ${point.cost} z≈Ç/‚Ç¨<br>
            ${point.img ? `<img src="${point.img}" width="100">` : ''}
        `);
    }
</script>
<!-- SEKSCJA: Lista Punkt√≥w -->
<section id="points-section" class="container">
    <h2>Punkty</h2>

    <label for="filterType">Filtruj po typie:</label>
    <select id="filterType">
        <option value="">Wszystkie</option>
        <option value="Atrakcja">Atrakcje</option>
        <option value="Jedzenie">Jedzenie</option>
        <option value="Nocleg">Noclegi</option>
        <option value="Inne">Inne</option>
    </select>

    <div id="pointsList"></div>
</section>

<script>
    let editingPointId = null;

    // Renderowanie listy punkt√≥w
    function renderPointsList() {
        const filter = document.getElementById('filterType').value;
        const listDiv = document.getElementById('pointsList');
        listDiv.innerHTML = '';

        const filteredPoints = filter
            ? points.filter(p => p.type === filter)
            : points;

        if (filteredPoints.length === 0) {
            listDiv.innerHTML = '<p>Brak punkt√≥w.</p>';
            return;
        }

        filteredPoints.forEach(p => {
            const pointEl = document.createElement('div');
            pointEl.style = "border: 1px solid #ccc; margin: 10px 0; padding: 10px; border-radius: 8px;";
            pointEl.innerHTML = `
                <strong>${p.name}</strong> (${p.type})<br>
                ${p.desc}<br>
                ${p.address}<br>
                Koszt: ${p.cost} z≈Ç/‚Ç¨<br>
                ${p.img ? `<img src="${p.img}" width="100">` : ''}
                <br><br>
                <button class="btn" onclick="editPoint(${p.id})">Edytuj</button>
                <button class="btn" onclick="confirmDeletePoint(${p.id})">Usu≈Ñ</button>
            `;
            listDiv.appendChild(pointEl);
        });
    }

    // Obs≈Çuga usuwania
    function confirmDeletePoint(id) {
        if (confirm("Czy na pewno chcesz usunƒÖƒá?")) {
            points = points.filter(p => p.id !== id);
            renderPointsList();
            refreshMapMarkers();
        }
    }

    // Obs≈Çuga edycji
    function editPoint(id) {
        const point = points.find(p => p.id === id);
        if (!point) return;

        editingPointId = id;

        document.getElementById('pointName').value = point.name;
        document.getElementById('pointType').value = point.type;
        document.getElementById('pointDesc').value = point.desc;
        document.getElementById('pointAddress').value = point.address;
        document.getElementById('pointCost').value = point.cost;
        document.getElementById('pointImg').value = point.img;
        selectedLatLng = point.latlng;

        openModal();
    }

    // Modyfikacja zapisujƒÖca edytowany punkt
    document.getElementById('pointForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const data = {
            name: document.getElementById('pointName').value,
            type: document.getElementById('pointType').value,
            desc: document.getElementById('pointDesc').value,
            address: document.getElementById('pointAddress').value,
            cost: parseFloat(document.getElementById('pointCost').value) || 0,
            img: document.getElementById('pointImg').value,
            latlng: selectedLatLng
        };

        if (editingPointId !== null) {
            const index = points.findIndex(p => p.id === editingPointId);
            points[index] = { ...points[index], ...data };
            editingPointId = null;
        } else {
            points.push({ ...data, id: Date.now() });
        }

        closeModal();
        renderPointsList();
        refreshMapMarkers();
    });

    // Od≈õwie≈ºenie znacznik√≥w na mapie
    function refreshMapMarkers() {
        map.eachLayer(layer => {
            if (layer instanceof L.CircleMarker) {
                map.removeLayer(layer);
            }
        });

        points.forEach(p => addMarkerToMap(p));
    }

    document.getElementById('filterType').addEventListener('change', renderPointsList);
</script>
<!-- SEKCJA: Dodaj trasƒô -->
<section id="add-route-section" class="container">
    <h2>Dodaj trasƒô</h2>
    <form id="routeForm">
        <label>Punkt poczƒÖtkowy:</label>
        <select id="startPoint" required></select><br><br>

        <label>Punkt ko≈Ñcowy:</label>
        <select id="endPoint" required></select><br><br>

        <label>Data i godzina odjazdu:</label>
        <input type="datetime-local" id="startTime" required><br><br>

        <label>Data i godzina przyjazdu:</label>
        <input type="datetime-local" id="endTime" required><br><br>

        <label>Opis:</label>
        <textarea id="routeDesc" placeholder="Opis trasy"></textarea><br><br>

        <label>Koszt (z≈Ç/‚Ç¨):</label>
        <input type="number" id="routeCost" required><br><br>

        <button type="submit" class="btn">Dodaj trasƒô</button>
    </form>
</section>

<script>
    let routes = [];

    // Uzupe≈Çnij listƒô dostƒôpnych punkt√≥w w formularzu trasy
    function updateRoutePointOptions() {
        const startSelect = document.getElementById('startPoint');
        const endSelect = document.getElementById('endPoint');
        startSelect.innerHTML = '';
        endSelect.innerHTML = '';

        points.forEach(p => {
            const optionStart = document.createElement('option');
            const optionEnd = document.createElement('option');
            optionStart.value = p.id;
            optionStart.textContent = p.name;
            optionEnd.value = p.id;
            optionEnd.textContent = p.name;
            startSelect.appendChild(optionStart);
            endSelect.appendChild(optionEnd);
        });
    }

    // Obs≈Çuga formularza dodawania trasy
    document.getElementById('routeForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const startId = parseInt(document.getElementById('startPoint').value);
        const endId = parseInt(document.getElementById('endPoint').value);
        const startPoint = points.find(p => p.id === startId);
        const endPoint = points.find(p => p.id === endId);

        if (!startPoint || !endPoint || startId === endId) {
            alert("Wybierz dwa r√≥≈ºne punkty.");
            return;
        }

        const route = {
            id: Date.now(),
            start: startPoint,
            end: endPoint,
            startTime: document.getElementById('startTime').value,
            endTime: document.getElementById('endTime').value,
            desc: document.getElementById('routeDesc').value,
            cost: parseFloat(document.getElementById('routeCost').value) || 0
        };

        routes.push(route);
        drawRouteOnMap(route);
        renderRouteList();
        document.getElementById('routeForm').reset();
    });

    // Narysuj trasƒô na mapie
    function drawRouteOnMap(route) {
        const polyline = L.polyline([
            route.start.latlng,
            route.end.latlng
        ], { color: 'red', weight: 4 }).addTo(map);

        route.polyline = polyline;
    }

    // Od≈õwie≈ºenie list wyboru punkt√≥w przy ka≈ºdej zmianie punkt√≥w
    // Wywo≈Çaj np. po renderPointsList()
    // Mo≈ºna te≈º dodaƒá np. do closeModal()
    document.getElementById('pointForm').addEventListener('submit', () => {
        setTimeout(updateRoutePointOptions, 0);
    });
</script>
<!-- SEKCJA: Lista tras -->
<section id="route-list-section" class="container">
    <h2>Trasy</h2>
    <div id="routesList"></div>
</section>

<script>
    let editingRouteId = null;

    function renderRouteList() {
        const listDiv = document.getElementById('routesList');
        listDiv.innerHTML = '';

        if (routes.length === 0) {
            listDiv.innerHTML = '<p>Brak tras.</p>';
            return;
        }

        routes.forEach(r => {
            const routeEl = document.createElement('div');
            routeEl.style = "border: 1px solid #ddd; margin: 10px 0; padding: 10px; border-radius: 8px;";
            routeEl.innerHTML = `
                <strong>${r.start.name}</strong> ‚Üí <strong>${r.end.name}</strong><br>
                Od: ${new Date(r.startTime).toLocaleString()}<br>
                Do: ${new Date(r.endTime).toLocaleString()}<br>
                Opis: ${r.desc}<br>
                Koszt: ${r.cost} z≈Ç/‚Ç¨<br><br>
                <button class="btn" onclick="editRoute(${r.id})">Edytuj</button>
                <button class="btn" onclick="confirmDeleteRoute(${r.id})">Usu≈Ñ</button>
            `;
            listDiv.appendChild(routeEl);
        });
    }

    // Usuwanie trasy
    function confirmDeleteRoute(id) {
        if (confirm("Czy na pewno chcesz usunƒÖƒá tƒô trasƒô?")) {
            const route = routes.find(r => r.id === id);
            if (route.polyline) {
                map.removeLayer(route.polyline);
            }
            routes = routes.filter(r => r.id !== id);
            renderRouteList();
        }
    }

    // Edycja trasy
    function editRoute(id) {
        const route = routes.find(r => r.id === id);
        if (!route) return;

        editingRouteId = id;

        document.getElementById('startPoint').value = route.start.id;
        document.getElementById('endPoint').value = route.end.id;
        document.getElementById('startTime').value = route.startTime;
        document.getElementById('endTime').value = route.endTime;
        document.getElementById('routeDesc').value = route.desc;
        document.getElementById('routeCost').value = route.cost;

        document.querySelector('#add-route-section h2').innerText = 'Edytuj trasƒô';
        document.querySelector('#routeForm button').innerText = 'Zapisz zmiany';
    }

    // Obs≈Çuga edycji w formularzu
    document.getElementById('routeForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const startId = parseInt(document.getElementById('startPoint').value);
        const endId = parseInt(document.getElementById('endPoint').value);
        const startPoint = points.find(p => p.id === startId);
        const endPoint = points.find(p => p.id === endId);

        if (!startPoint || !endPoint || startId === endId) {
            alert("Wybierz dwa r√≥≈ºne punkty.");
            return;
        }

        const data = {
            start: startPoint,
            end: endPoint,
            startTime: document.getElementById('startTime').value,
            endTime: document.getElementById('endTime').value,
            desc: document.getElementById('routeDesc').value,
            cost: parseFloat(document.getElementById('routeCost').value) || 0
        };

        if (editingRouteId !== null) {
            const index = routes.findIndex(r => r.id === editingRouteId);
            const oldRoute = routes[index];
            if (oldRoute.polyline) map.removeLayer(oldRoute.polyline);

            routes[index] = { ...routes[index], ...data };
            drawRouteOnMap(routes[index]);

            editingRouteId = null;
            document.querySelector('#add-route-section h2').innerText = 'Dodaj trasƒô';
            document.querySelector('#routeForm button').innerText = 'Dodaj trasƒô';
        } else {
            const newRoute = {
                id: Date.now(),
                ...data
            };
            routes.push(newRoute);
            drawRouteOnMap(newRoute);
        }

        renderRouteList();
        document.getElementById('routeForm').reset();
    });
</script>
<!-- SEKCJA: Koszty ≈ÇƒÖcznie -->
<section id="summary-costs-section" class="container">
    <h2>Koszty ≈ÇƒÖcznie</h2>
    <div id="totalCosts">
        <ul id="costList">
            <li>Jedzenie: <span id="costFood">0</span> z≈Ç/‚Ç¨</li>
            <li>Noclegi: <span id="costLodging">0</span> z≈Ç/‚Ç¨</li>
            <li>Atrakcje: <span id="costAttractions">0</span> z≈Ç/‚Ç¨</li>
            <li>Transport: <span id="costTransport">0</span> z≈Ç/‚Ç¨</li>
            <li>Inne: <span id="costOther">0</span> z≈Ç/‚Ç¨</li>
            <li>Dodatkowe: <span id="costExtra">0</span> z≈Ç/‚Ç¨</li>
        </ul>
    </div>
</section>

<script>
    let extraCosts = [];

    function calculateCosts() {
        let food = 0, lodging = 0, attractions = 0, other = 0, transport = 0, extra = 0;

        // Koszty z punkt√≥w
        points.forEach(p => {
            const c = parseFloat(p.cost) || 0;
            switch (p.type) {
                case 'Jedzenie': food += c; break;
                case 'Nocleg': lodging += c; break;
                case 'Atrakcja': attractions += c; break;
                case 'Inne': other += c; break;
            }
        });

        // Koszty z tras (transport)
        routes.forEach(r => {
            transport += parseFloat(r.cost) || 0;
        });

        // Koszty dodatkowe
        extraCosts.forEach(ec => {
            extra += parseFloat(ec.cost) || 0;
        });

        // Wy≈õwietl wyniki
        document.getElementById('costFood').textContent = food.toFixed(2);
        document.getElementById('costLodging').textContent = lodging.toFixed(2);
        document.getElementById('costAttractions').textContent = attractions.toFixed(2);
        document.getElementById('costTransport').textContent = transport.toFixed(2);
        document.getElementById('costOther').textContent = other.toFixed(2);
        document.getElementById('costExtra').textContent = extra.toFixed(2);
    }

    // Automatyczna aktualizacja koszt√≥w przy dodaniu/usuniƒôciu punktu/trasy/kosztu
    const recalculateAll = () => {
        renderPointsList();
        renderRouteList();
        calculateCosts();
    };

    // Dodaj wywo≈Çania funkcji `calculateCosts()` po ka≈ºdej aktualizacji danych
    // Przyk≈Çad:
    // - po `routes.push(...)` => call `calculateCosts()`
    // - po `points.push(...)` => call `calculateCosts()`
    // - po `extraCosts.push(...)` => call `calculateCosts()`
</script>
<!-- SEKCJA: Koszty dodatkowe -->
<section id="extra-costs-section" class="container">
  <h2>Koszty dodatkowe</h2>

  <form id="extraCostForm">
    <label>Opis kosztu:
      <input type="text" id="extraDesc" required />
    </label>
    <label>Koszt (z≈Ç/‚Ç¨):
      <input type="number" id="extraCost" required />
    </label>
    <button type="submit" class="btn">Dodaj koszt</button>
  </form>

  <div id="extraCostsList" style="margin-top:1em;"></div>
</section>

<script>
  let editingExtraId = null;

  function renderExtraCosts() {
    const container = document.getElementById('extraCostsList');
    container.innerHTML = '';

    if (extraCosts.length === 0) {
      container.innerHTML = '<p>Brak dodatkowych koszt√≥w.</p>';
      return;
    }

    extraCosts.forEach(ec => {
      const div = document.createElement('div');
      div.className = 'extra-cost-item';
      div.style = "border:1px solid #ccc; padding:10px; margin-bottom:10px; border-radius:8px;";
      div.innerHTML = `
        <strong>${ec.desc}</strong> ‚Äì ${ec.cost.toFixed(2)} z≈Ç/‚Ç¨
        <br>
        <button class="btn" onclick="editExtraCost(${ec.id})">Edytuj</button>
        <button class="btn" onclick="confirmDeleteExtra(${ec.id})">Usu≈Ñ</button>
      `;
      container.appendChild(div);
    });
  }

  function confirmDeleteExtra(id) {
    if (confirm("Czy na pewno chcesz usunƒÖƒá ten koszt?")) {
      extraCosts = extraCosts.filter(e => e.id !== id);
      renderExtraCosts();
      calculateCosts();
    }
  }

  function editExtraCost(id) {
    const cost = extraCosts.find(e => e.id === id);
    if (!cost) return;

    document.getElementById('extraDesc').value = cost.desc;
    document.getElementById('extraCost').value = cost.cost;
    editingExtraId = id;
    document.querySelector('#extra-costs-section button').innerText = 'Zapisz zmiany';
  }

  document.getElementById('extraCostForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const desc = document.getElementById('extraDesc').value.trim();
    const cost = parseFloat(document.getElementById('extraCost').value) || 0;

    if (!desc) return;

    if (editingExtraId !== null) {
      const index = extraCosts.findIndex(e => e.id === editingExtraId);
      extraCosts[index] = { id: editingExtraId, desc, cost };
      editingExtraId = null;
      document.querySelector('#extra-costs-section button').innerText = 'Dodaj koszt';
    } else {
      extraCosts.push({ id: Date.now(), desc, cost });
    }

    document.getElementById('extraCostForm').reset();
    renderExtraCosts();
    calculateCosts();
  });
</script>
<!-- SEKCJA: Lista punkt√≥w -->
<section id="points-list-section" class="container">
  <h2>Punkty</h2>

  <label for="filterType">Filtruj wed≈Çug typu:</label>
  <select id="filterType">
    <option value="Wszystko">Wszystko</option>
    <option value="Atrakcja">Atrakcja</option>
    <option value="Jedzenie">Jedzenie</option>
    <option value="Nocleg">Nocleg</option>
    <option value="Inne">Inne</option>
  </select>

  <div id="pointsList" style="margin-top: 1em;"></div>
</section>

<script>
  const pointTypesColors = {
    "Atrakcja": "red",
    "Jedzenie": "orange",
    "Nocleg": "blue",
    "Inne": "gray"
  };

  function renderPointsList() {
    const list = document.getElementById('pointsList');
    list.innerHTML = '';

    const filter = document.getElementById('filterType').value;
    const filtered = filter === 'Wszystko' ? points : points.filter(p => p.type === filter);

    if (filtered.length === 0) {
      list.innerHTML = '<p>Brak punkt√≥w do wy≈õwietlenia.</p>';
      return;
    }

    filtered.forEach(point => {
      const div = document.createElement('div');
      div.className = 'point-entry';
      div.style = `border: 1px solid ${pointTypesColors[point.type] || 'black'}; border-radius: 8px; padding: 10px; margin-bottom: 10px;`;

      div.innerHTML = `
        <strong>${point.name}</strong> (${point.type})<br>
        Adres: ${point.address}<br>
        Koszt: ${point.cost} z≈Ç/‚Ç¨<br>
        <a href="${point.image}" target="_blank">Obrazek</a><br>
        <button class="btn" onclick="editPoint(${point.id})">Edytuj</button>
        <button class="btn" onclick="confirmDeletePoint(${point.id})">Usu≈Ñ</button>
      `;

      list.appendChild(div);
    });
  }

  function confirmDeletePoint(id) {
    if (confirm("Czy na pewno chcesz usunƒÖƒá ten punkt?")) {
      const index = points.findIndex(p => p.id === id);
      if (index !== -1) {
        map.removeLayer(points[index].marker);
        points.splice(index, 1);
        recalculateAll();
      }
    }
  }

  function editPoint(id) {
    const point = points.find(p => p.id === id);
    if (!point) return;

    // Pokazujemy formularz edycji punktu (u≈ºytkownik mo≈ºe np. kliknƒÖƒá na mapie lub dodaƒá modal)
    alert("Tryb edycji dla punktu: " + point.name + "\n(Pod≈ÇƒÖcz modal/formularz edycji punktu w przysz≈Çych czƒô≈õciach)");
  }

  // Obs≈Çuga filtrowania po typie
  document.getElementById('filterType').addEventListener('change', renderPointsList);
</script>
<!-- MODAL: Edycja punktu -->
<div id="editPointModal" class="modal" style="display:none;">
  <div class="modal-content">
    <h3>Edytuj punkt</h3>
    <form id="editPointForm">
      <label>Nazwa:
        <input type="text" id="editName" required />
      </label>
      <label>Typ:
        <select id="editType">
          <option value="Atrakcja">Atrakcja</option>
          <option value="Jedzenie">Jedzenie</option>
          <option value="Nocleg">Nocleg</option>
          <option value="Inne">Inne</option>
        </select>
      </label>
      <label>Adres:
        <input type="text" id="editAddress" />
      </label>
      <label>Koszt (z≈Ç/‚Ç¨):
        <input type="number" id="editCost" />
      </label>
      <label>URL obrazka:
        <input type="url" id="editImage" />
      </label>
      <div style="margin-top: 1em;">
        <button type="submit" class="btn">Zapisz</button>
        <button type="button" class="btn" onclick="closeEditModal()">Anuluj</button>
      </div>
    </form>
  </div>
</div>

<style>
  .modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    display: flex; align-items: center; justify-content: center;
    z-index: 1000;
  }
  .modal-content {
    background: white;
    padding: 20px;
    max-width: 400px;
    border-radius: 12px;
    box-shadow: 0 0 10px #0003;
  }
  .modal-content input, .modal-content select {
    width: 100%;
    margin-bottom: 10px;
  }
</style>

<script>
  let editingPointId = null;

  function editPoint(id) {
    const point = points.find(p => p.id === id);
    if (!point) return;

    editingPointId = id;
    document.getElementById('editName').value = point.name;
    document.getElementById('editType').value = point.type;
    document.getElementById('editAddress').value = point.address;
    document.getElementById('editCost').value = point.cost;
    document.getElementById('editImage').value = point.image;

    document.getElementById('editPointModal').style.display = 'flex';
  }

  function closeEditModal() {
    editingPointId = null;
    document.getElementById('editPointModal').style.display = 'none';
    document.getElementById('editPointForm').reset();
  }

  document.getElementById('editPointForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const updated = {
      name: document.getElementById('editName').value.trim(),
      type: document.getElementById('editType').value,
      address: document.getElementById('editAddress').value.trim(),
      cost: parseFloat(document.getElementById('editCost').value) || 0,
      image: document.getElementById('editImage').value.trim(),
    };

    const index = points.findIndex(p => p.id === editingPointId);
    if (index !== -1) {
      const old = points[index];
      old.name = updated.name;
      old.type = updated.type;
      old.address = updated.address;
      old.cost = updated.cost;
      old.image = updated.image;

      // Aktualizuj znacznik na mapie
      const icon = createCustomIcon(updated.type);
      const popup = generatePopupContent(old);
      map.removeLayer(old.marker);
      const newMarker = L.marker(old.latlng, { icon }).bindPopup(popup);
      newMarker.addTo(map);
      old.marker = newMarker;

      closeEditModal();
      renderPointsList();
      calculateCosts();
    }
  });
</script>
<!-- SEKCJA: Dodaj trasƒô -->
<section id="add-route-section" class="container">
  <h2>Dodaj trasƒô</h2>
  <form id="routeForm">
    <label>Punkt poczƒÖtkowy:
      <select id="routeStart" required></select>
    </label>
    <label>Punkt ko≈Ñcowy:
      <select id="routeEnd" required></select>
    </label>
    <label>Data i godzina odjazdu:
      <input type="datetime-local" id="routeStartTime" required />
    </label>
    <label>Data i godzina przyjazdu:
      <input type="datetime-local" id="routeEndTime" required />
    </label>
    <label>Opis trasy:
      <textarea id="routeDescription"></textarea>
    </label>
    <label>Koszt (z≈Ç/‚Ç¨):
      <input type="number" id="routeCost" />
    </label>
    <button type="submit" class="btn">Dodaj trasƒô</button>
  </form>
</section>

<script>
  const routes = [];

  function updateRouteSelectors() {
    const startSelect = document.getElementById('routeStart');
    const endSelect = document.getElementById('routeEnd');
    startSelect.innerHTML = '';
    endSelect.innerHTML = '';

    points.forEach(point => {
      const option = `<option value="${point.id}">${point.name} (${point.type})</option>`;
      startSelect.innerHTML += option;
      endSelect.innerHTML += option;
    });
  }

  function getPointById(id) {
    return points.find(p => p.id == id);
  }

  document.getElementById('routeForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const startId = document.getElementById('routeStart').value;
    const endId = document.getElementById('routeEnd').value;

    if (startId === endId) {
      alert("Punkt poczƒÖtkowy i ko≈Ñcowy nie mogƒÖ byƒá takie same.");
      return;
    }

    const startPoint = getPointById(startId);
    const endPoint = getPointById(endId);
    if (!startPoint || !endPoint) return;

    const newRoute = {
      id: Date.now(),
      startId: startPoint.id,
      endId: endPoint.id,
      startTime: document.getElementById('routeStartTime').value,
      endTime: document.getElementById('routeEndTime').value,
      description: document.getElementById('routeDescription').value,
      cost: parseFloat(document.getElementById('routeCost').value) || 0,
      line: null
    };

    // Rysowanie linii na mapie
    const latlngs = [startPoint.latlng, endPoint.latlng];
    const polyline = L.polyline(latlngs, { color: 'green' }).addTo(map);
    newRoute.line = polyline;

    routes.push(newRoute);
    recalculateAll();

    // Reset
    e.target.reset();
    alert("Trasa dodana!");
  });

  // Aktualizuj selecty przy ka≈ºdej zmianie punkt√≥w
  document.addEventListener('DOMContentLoaded', updateRouteSelectors);
</script>
<!-- SEKCJA: Lista tras -->
<section id="routes-section" class="container">
  <h2>Trasy</h2>
  <ul id="routeList" class="list"></ul>
</section>

<!-- MODAL: Potwierdzenie usuniƒôcia trasy -->
<div id="deleteRouteModal" class="modal" style="display:none;">
  <div class="modal-content">
    <p>Czy na pewno chcesz usunƒÖƒá tƒô trasƒô?</p>
    <button class="btn" onclick="confirmDeleteRoute()">Tak</button>
    <button class="btn" onclick="closeDeleteRouteModal()">Anuluj</button>
  </div>
</div>

<script>
  let routeToDelete = null;

  function renderRouteList() {
    const list = document.getElementById('routeList');
    list.innerHTML = '';

    if (routes.length === 0) {
      list.innerHTML = '<li>Brak tras</li>';
      return;
    }

    routes.forEach(route => {
      const start = getPointById(route.startId);
      const end = getPointById(route.endId);

      const li = document.createElement('li');
      li.innerHTML = `
        <strong>${start?.name || 'üó∫'} ‚Üí ${end?.name || 'üó∫'}</strong><br/>
        <small>${route.startTime} ‚Üí ${route.endTime}</small><br/>
        <span>${route.description || 'Brak opisu'}</span><br/>
        Koszt: ${route.cost} z≈Ç/‚Ç¨<br/>
        <button class="btn" onclick="promptDeleteRoute(${route.id})">Usu≈Ñ</button>
        <button class="btn" onclick="editRoute(${route.id})" disabled>Edytuj</button>
      `;
      list.appendChild(li);
    });
  }

  function promptDeleteRoute(routeId) {
    routeToDelete = routeId;
    document.getElementById('deleteRouteModal').style.display = 'flex';
  }

  function closeDeleteRouteModal() {
    routeToDelete = null;
    document.getElementById('deleteRouteModal').style.display = 'none';
  }

  function confirmDeleteRoute() {
    const index = routes.findIndex(r => r.id === routeToDelete);
    if (index !== -1) {
      const route = routes[index];
      if (route.line) map.removeLayer(route.line);
      routes.splice(index, 1);
    }
    closeDeleteRouteModal();
    renderRouteList();
    calculateCosts();
  }

  function editRoute(id) {
    // (opcjonalnie w 12/12) ‚Äì mo≈ºna dodaƒá formularz edycji tras jak w przypadku punkt√≥w
    alert("Funkcja edycji trasy w przygotowaniu.");
  }

  function recalculateAll() {
    renderPointsList();
    updateRouteSelectors();
    renderRouteList();
    calculateCosts();
  }

  document.addEventListener('DOMContentLoaded', () => {
    renderRouteList();
  });
</script>
<!-- SEKCJA: Koszty ≈ÇƒÖcznie -->
<section id="total-costs-section" class="container">
  <h2>Koszty ≈ÇƒÖcznie</h2>
  <p>Ca≈Çkowite koszty podr√≥≈ºy, podzielone na kategorie:</p>
  <ul id="totalCostsList">
    <li>Jedzenie: <span id="foodCosts">0 z≈Ç</span></li>
    <li>Noclegi: <span id="accommodationCosts">0 z≈Ç</span></li>
    <li>Atrakcje: <span id="attractionCosts">0 z≈Ç</span></li>
    <li>Transport: <span id="transportCosts">0 z≈Ç</span></li>
    <li>Dodatkowe: <span id="extraCosts">0 z≈Ç</span></li>
  </ul>
</section>

<!-- SEKCJA: Koszty dodatkowe -->
<section id="extra-costs-section" class="container">
  <h2>Koszty dodatkowe</h2>
  <form id="extraCostForm">
    <label>Opis kosztu:
      <input type="text" id="extraCostDescription" required />
    </label>
    <label>Koszt (z≈Ç/‚Ç¨):
      <input type="number" id="extraCostAmount" required />
    </label>
    <button type="submit" class="btn">Dodaj koszt</button>
  </form>

  <ul id="extraCostsList"></ul>
</section>

<script>
  const extraCosts = [];

  // Obliczanie wszystkich koszt√≥w
  function calculateCosts() {
    let food = 0, accommodation = 0, attractions = 0, transport = 0, extra = 0;

    // Koszty z punkt√≥w
    points.forEach(point => {
      if (point.type === 'Jedzenie') food += point.cost;
      if (point.type === 'Nocleg') accommodation += point.cost;
      if (point.type === 'Atrakcja') attractions += point.cost;
    });

    // Koszty z tras
    routes.forEach(route => {
      transport += route.cost;
    });

    // Koszty dodatkowe
    extraCosts.forEach(cost => {
      extra += cost.amount;
    });

    // Aktualizowanie widoku
    document.getElementById('foodCosts').textContent = `${food} z≈Ç`;
    document.getElementById('accommodationCosts').textContent = `${accommodation} z≈Ç`;
    document.getElementById('attractionCosts').textContent = `${attractions} z≈Ç`;
    document.getElementById('transportCosts').textContent = `${transport} z≈Ç`;
    document.getElementById('extraCosts').textContent = `${extra} z≈Ç`;
  }

  // Dodawanie kosztu dodatkowego
  document.getElementById('extraCostForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const description = document.getElementById('extraCostDescription').value.trim();
    const amount = parseFloat(document.getElementById('extraCostAmount').value) || 0;

    if (description && amount > 0) {
      const newExtraCost = { description, amount };
      extraCosts.push(newExtraCost);
      renderExtraCosts();
      calculateCosts();
      document.getElementById('extraCostForm').reset();
    }
  });

  // Renderowanie koszt√≥w dodatkowych
  function renderExtraCosts() {
    const list = document.getElementById('extraCostsList');
    list.innerHTML = '';

    if (extraCosts.length === 0) {
      list.innerHTML = '<li>Brak koszt√≥w dodatkowych</li>';
      return;
    }

    extraCosts.forEach((cost, index) => {
      const li = document.createElement('li');
      li.innerHTML = `${cost.description}: ${cost.amount} z≈Ç 
        <button class="btn" onclick="removeExtraCost(${index})">Usu≈Ñ</button>`;
      list.appendChild(li);
    });
  }

  // Usuwanie kosztu dodatkowego
  function removeExtraCost(index) {
    extraCosts.splice(index, 1);
    renderExtraCosts();
    calculateCosts();
  }

  // Inicjalizacja (po za≈Çadowaniu strony)
  document.addEventListener('DOMContentLoaded', function () {
    renderExtraCosts();
    calculateCosts();
  });
</script>
